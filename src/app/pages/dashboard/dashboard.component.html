<div class="dashboard-layout">
  <!-- Professional Header -->
  <header [class]="headerClass()" 
          [style.background]="isOnline() ? null : 'linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)'">
    <div class="header-content">
      <div class="header-left">
        <div class="logo-section">
          <app-logo 
            size="md" 
            [showText]="true" 
            theme="light" 
            background="white"
            [clickable]="true"
            [companyName]="appName()">
          </app-logo>
        </div>
        <div class="breadcrumb">
          <span class="breadcrumb-item">Dashboard</span>
        </div>
      </div>
      
      <div class="header-right">
        <div class="header-actions">
          <!-- Notifications -->
          <button class="header-btn" title="Notifications">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
            </svg>
            <span class="notification-badge">3</span>
          </button>
          
          <!-- Home Link -->
          <a routerLink="/" class="header-btn" title="Home">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2-2m0 0l7-7 7 7m-9 10v-8a1 1 0 011-1h2a1 1 0 011 1v8m0 0v1a1 1 0 001 1h4a1 1 0 001-1v-1m0 0V9a1 1 0 00-1-1h-2a1 1 0 00-1-1z" />
            </svg>
          </a>
          
          <!-- Help Link -->
          <a routerLink="/help" class="header-btn" title="Help">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </a>
        </div>
        
        <!-- User Menu -->
        <div class="user-menu" data-user-menu>
          <button 
            (click)="toggleUserMenu()" 
            class="user-avatar"
            [class.active]="isUserMenuOpen()"
          >
            <span class="avatar-text">{{ userInitial() }}</span>
            <svg class="dropdown-arrow" [class.rotate]="isUserMenuOpen()" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          
          <div *ngIf="isUserMenuOpen()" class="user-dropdown">
            <div class="user-info">
              <div class="user-name">{{ currentUser()?.displayName || currentUser()?.email }}</div>
              <div class="user-email">{{ currentUser()?.email }}</div>
            </div>
            <hr class="dropdown-divider">
            <a routerLink="/dashboard/overview" 
               (click)="closeUserMenu()" 
               class="dropdown-item">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
              </svg>
              Dashboard Overview
            </a>
            <a routerLink="/account-settings" 
               (click)="closeUserMenu()" 
               class="dropdown-item">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
              Account Settings
            </a>
            <button (click)="logout()" class="dropdown-item logout">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
              </svg>
              Sign out
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Dashboard Content -->
  <div class="dashboard-content">
    <!-- Professional Sidebar (desktop only) -->
    <nav class="dashboard-sidebar" *ngIf="screenWidth > 640">
      <div class="sidebar-header">
        <h2 class="sidebar-title">Management</h2>
      </div>
      <div class="nav-sections">
        <!-- Overview Section -->
        <div class="nav-section">
          <h3 class="nav-section-title">Overview</h3>
          <div class="nav-items">
            <a routerLink="overview" class="nav-item" [class.active]="isActiveNavItem('overview')">
              <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
              <span>Dashboard</span>
            </a>
          </div>
        </div>
        <!-- Company Profile (view only, all users) -->
        <div class="nav-section" *ngIf="permissions.canViewCompanyProfile">
          <h3 class="nav-section-title">Company</h3>
          <div class="nav-items">
            <a routerLink="company-profile" class="nav-item" [class.active]="isActiveNavItem('company-profile')">
              <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v4a1 1 0 001 1h3V7a1 1 0 00-1-1H4a1 1 0 00-1 1zm0 0V5a2 2 0 012-2h2a2 2 0 012 2v2m0 0h6m0 0V5a2 2 0 012-2h2a2 2 0 012 2v2m0 0v4a1 1 0 01-1 1h-3V7a1 1 0 011-1h2a1 1 0 011 1zm0 0v6a2 2 0 01-2 2h-2a2 2 0 01-2-2v-6m0 0H9" />
              </svg>
              <span>Company Profile</span>
            </a>
          </div>
        </div>
        <!-- Store Info (view only) -->
        <div class="nav-section" *ngIf="permissions.canViewStore">
          <h3 class="nav-section-title">Store</h3>
          <div class="nav-items">
            <a routerLink="stores" class="nav-item" [class.active]="isActiveNavItem('stores')" *ngIf="permissions.canViewStore">
              <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
              </svg>
              <span>Manage Store</span>
            </a>
          </div>
        </div>
        <!-- Access Management (hide for cashier) -->
        <div class="nav-section" *ngIf="permissions.canViewAccess">
          <h3 class="nav-section-title">Access</h3>
          <div class="nav-items">
            <a routerLink="access" class="nav-item" [class.active]="isActiveNavItem('access')">
              <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 17l-4 4m0 0l-4-4m4 4V3" />
              </svg>
              <span>Access Management</span>
            </a>
          </div>
        </div>
        <!-- User Roles (hide for cashier) -->
        <div class="nav-section" *ngIf="permissions.canViewUserRoles">
          <h3 class="nav-section-title">User Roles</h3>
          <div class="nav-items">
            <a routerLink="user-roles" class="nav-item" [class.active]="isActiveNavItem('user-roles')">
              <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a4 4 0 00-3-3.87M9 20h6M3 20h5v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75M8 3.13a4 4 0 010 7.75" />
              </svg>
              <span>User Roles</span>
            </a>
          </div>
        </div>
        <!-- Products (view only) -->
        <div class="nav-section" *ngIf="permissions.canViewProducts">
          <h3 class="nav-section-title">Products</h3>
          <div class="nav-items">
            <a routerLink="products" class="nav-item" [class.active]="isActiveNavItem('products')" *ngIf="permissions.canViewProducts">
              <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
              </svg>
              <span>Products</span>
            </a>
          </div>
        </div>
        <!-- POS (Cashier, Manager, Admin) -->
        <div class="nav-section" *ngIf="permissions.canViewPOS">
          <h3 class="nav-section-title">Sales</h3>
          <div class="nav-items">
            <a routerLink="/pos" class="nav-item pos-special" [class.active]="isActiveNavItem('pos')">
              <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <span>Point of Sale</span>
              <span class="pos-badge">POS</span>
            </a>
            <a routerLink="sales/summary" class="nav-item" [class.active]="isActiveNavItem('sales-summary')" *ngIf="permissions.canViewSalesReports">
              <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
              </svg>
              <span>Sales Summary</span>
            </a>
          </div>
        </div>
        <!-- Inventory (view only) -->
        <div class="nav-section" *ngIf="permissions.canViewInventory">
          <h3 class="nav-section-title">Inventory</h3>
          <div class="nav-items">
            <a routerLink="inventory" class="nav-item" [class.active]="isActiveNavItem('inventory')" *ngIf="permissions.canViewInventory">
              <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
              </svg>
              <span>Inventory</span>
            </a>
            <a routerLink="reconciliation" class="nav-item" [class.active]="isActiveNavItem('reconciliation')" *ngIf="permissions.canViewInventory">
              <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
              </svg>
              <span>Reconciliation</span>
            </a>
          </div>
        </div>
        <!-- Hide add/remove actions for cashier -->
        <!-- ...existing code for other roles... -->
      </div>
    </nav>

    <!-- Top Bar for Mobile (horizontal, icons + tooltip) -->
    <nav class="nav-top-bar" *ngIf="screenWidth <= 640"
         style="position:fixed;top:56px;left:0;width:100%;background:#fff;z-index:50;box-shadow:0 2px 8px rgba(0,0,0,0.08);display:flex;justify-content:center;align-items:center;height:64px;">
      <a routerLink="overview" class="mx-6 flex flex-col items-center group relative" title="Dashboard Overview">
        <svg class="h-8 w-8 transition-transform duration-150 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
        </svg>
        <span class="absolute bottom-[-1.4rem] left-1/2 -translate-x-1/2 px-2 py-1 bg-gray-900 text-white text-xs rounded shadow-lg opacity-0 group-hover:opacity-100 group-active:opacity-100 transition pointer-events-none whitespace-nowrap">Overview</span>
      </a>
      <a routerLink="company-profile" *ngIf="permissions.canViewCompanyProfile" class="mx-6 flex flex-col items-center group relative" title="Company Profile">
        <svg class="h-8 w-8 transition-transform duration-150 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v4a1 1 0 001 1h3V7a1 1 0 00-1-1H4a1 1 0 00-1 1zm0 0V5a2 2 0 012-2h2a2 2 0 012 2v2m0 0h6m0 0V5a2 2 0 012-2h2a2 2 0 012 2v2m0 0v4a1 1 0 01-1 1h-3V7a1 1 0 011-1h2a1 1 0 011 1zm0 0v6a2 2 0 01-2 2h-2a2 2 0 01-2-2v-6m0 0H9" />
        </svg>
        <span class="absolute bottom-[-1.4rem] left-1/2 -translate-x-1/2 px-2 py-1 bg-gray-900 text-white text-xs rounded shadow-lg opacity-0 group-hover:opacity-100 group-active:opacity-100 transition pointer-events-none whitespace-nowrap">Company</span>
      </a>
      <a routerLink="stores" *ngIf="permissions.canViewStore" class="mx-6 flex flex-col items-center group relative" title="Manage Store">
        <svg class="h-8 w-8 transition-transform duration-150 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
        </svg>
        <span class="absolute bottom-[-1.4rem] left-1/2 -translate-x-1/2 px-2 py-1 bg-gray-900 text-white text-xs rounded shadow-lg opacity-0 group-hover:opacity-100 group-active:opacity-100 transition pointer-events-none whitespace-nowrap">Store</span>
      </a>
      <a routerLink="access" *ngIf="permissions.canViewAccess" class="mx-6 flex flex-col items-center group relative" title="Access Management">
        <svg class="h-8 w-8 transition-transform duration-150 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 17l-4 4m0 0l-4-4m4 4V3" />
        </svg>
        <span class="absolute bottom-[-1.4rem] left-1/2 -translate-x-1/2 px-2 py-1 bg-gray-900 text-white text-xs rounded shadow-lg opacity-0 group-hover:opacity-100 group-active:opacity-100 transition pointer-events-none whitespace-nowrap">Access</span>
      </a>
      <a routerLink="user-roles" *ngIf="permissions.canViewUserRoles" class="mx-6 flex flex-col items-center group relative" title="User Roles">
        <svg class="h-8 w-8 transition-transform duration-150 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a4 4 0 00-3-3.87M9 20h6M3 20h5v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75M8 3.13a4 4 0 010 7.75" />
        </svg>
        <span class="absolute bottom-[-1.4rem] left-1/2 -translate-x-1/2 px-2 py-1 bg-gray-900 text-white text-xs rounded shadow-lg opacity-0 group-hover:opacity-100 group-active:opacity-100 transition pointer-events-none whitespace-nowrap">User Roles</span>
      </a>
      <a routerLink="products" *ngIf="permissions.canViewProducts" class="mx-6 flex flex-col items-center group relative" title="Products">
        <svg class="h-8 w-8 transition-transform duration-150 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
        </svg>
        <span class="absolute bottom-[-1.4rem] left-1/2 -translate-x-1/2 px-2 py-1 bg-gray-900 text-white text-xs rounded shadow-lg opacity-0 group-hover:opacity-100 group-active:opacity-100 transition pointer-events-none whitespace-nowrap">Products</span>
      </a>
      <a routerLink="/pos" *ngIf="permissions.canViewPOS" class="mx-6 flex flex-col items-center group relative" title="Point of Sale">
        <svg class="h-8 w-8 transition-transform duration-150 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span class="absolute bottom-[-1.4rem] left-1/2 -translate-x-1/2 px-2 py-1 bg-gray-900 text-white text-xs rounded shadow-lg opacity-0 group-hover:opacity-100 group-active:opacity-100 transition pointer-events-none whitespace-nowrap">POS</span>
      </a>
      <a routerLink="sales/summary" *ngIf="permissions.canViewSalesReports" class="mx-6 flex flex-col items-center group relative" title="Sales Summary">
        <svg class="h-8 w-8 transition-transform duration-150 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
        </svg>
        <span class="absolute bottom-[-1.4rem] left-1/2 -translate-x-1/2 px-2 py-1 bg-gray-900 text-white text-xs rounded shadow-lg opacity-0 group-hover:opacity-100 group-active:opacity-100 transition pointer-events-none whitespace-nowrap">Sales</span>
      </a>
      <a routerLink="inventory" *ngIf="permissions.canViewInventory" class="mx-6 flex flex-col items-center group relative" title="Inventory">
        <svg class="h-8 w-8 transition-transform duration-150 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
        </svg>
        <span class="absolute bottom-[-1.4rem] left-1/2 -translate-x-1/2 px-2 py-1 bg-gray-900 text-white text-xs rounded shadow-lg opacity-0 group-hover:opacity-100 group-active:opacity-100 transition pointer-events-none whitespace-nowrap">Inventory</span>
      </a>
      <a routerLink="reconciliation" *ngIf="permissions.canViewInventory" class="mx-6 flex flex-col items-center group relative" title="Reconciliation">
        <svg class="h-8 w-8 transition-transform duration-150 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
        </svg>
        <span class="absolute bottom-[-1.4rem] left-1/2 -translate-x-1/2 px-2 py-1 bg-gray-900 text-white text-xs rounded shadow-lg opacity-0 group-hover:opacity-100 group-active:opacity-100 transition pointer-events-none whitespace-nowrap">Reconciliation</span>
      </a>
      <!-- Hide add/remove actions for cashier -->
      <!-- ...existing code for other roles... -->
    </nav>

    <!-- Main Panel -->
    <main class="dashboard-main" [style.marginTop]="screenWidth <= 640 ? '64px' : '0'">
      <div class="main-content">
        <router-outlet></router-outlet>
      </div>
    </main>
  </div>
</div>
